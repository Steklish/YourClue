# Состояния приложения YourcClue

## Обзор
В этом документе описываются различные состояния приложения YourcClue для создания диаграммы состояний. YourcClue — это приложение для создания заметок на основе геолокации для Android, которое позволяет пользователям создавать, редактировать и связывать заметки на карте.

## Состояния приложения

### 1. **Начальное состояние / Состояние запуска**
- **Описание**: Приложение запускается и инициализирует основные компоненты.
- **Действия**: Загрузка ресурсов карты, проверка разрешений, инициализация хранилища.
- **Триггеры**: Запуск приложения пользователем.
- **Переходы**:
  - В состояние просмотра карты (если разрешения предоставлены).
  - В состояние запроса разрешений (если разрешения не предоставлены).

### 2. **Состояние запроса разрешений**
- **Описание**: Ожидание предоставления пользователем разрешений на определение местоположения.
- **Действия**: Отображение диалогового окна запроса разрешений.
- **Триггеры**: Приложение обнаруживает отсутствие необходимых разрешений.
- **Переходы**:
  - В состояние просмотра карты (если разрешения предоставлены).
  - В состояние отказа в разрешении (если в разрешениях отказано).

### 3. **Состояние отказа в разрешении**
- **Описание**: Пользователь отказал в предоставлении разрешений на определение местоположения.
- **Действия**: Отображение предупреждающего сообщения, предложение альтернативных вариантов.
- **Триггеры**: Отказ пользователя в предоставлении разрешений.
- **Переходы**:
  - В состояние просмотра карты (если пользователь предоставит разрешения позже).
  - В состояние выхода (если пользователь решит не использовать приложение).

### 4. **Состояние просмотра карты (основное состояние)**
- **Описание**: Основное состояние приложения с отображаемой интерактивной картой.
- **Действия**: Отрисовка карты, отображение маркеров, обработка взаимодействия с пользователем.
- **Триггеры**: Успешная инициализация и получение разрешений.
- **Подсостояния/События**:
  - Карта загружается.
  - Карта готова и отображается.
  - Определяется местоположение по GPS.
  - Текущее местоположение пользователя отмечено на карте.
- **Переходы**:
  - В состояние создания заметки (когда пользователь нажимает для создания маркера).
  - В состояние редактирования заметки (когда пользователь долго нажимает на существующую заметку).
  - В состояние просмотра заметки (когда пользователь нажимает на существующую заметку).
  - В состояние фильтрации по календарю (при открытии календаря).
  - В состояние поиска (при использовании функции поиска).

### 5. **Состояние создания заметки**
- **Описание**: Пользователь находится в процессе создания новой заметки.
- **Действия**: Временное размещение маркера, отображение всплывающего окна редактора заметок.
- **Триггеры**: Пользователь нажимает кнопку «Добавить маркер» или нажимает на карту после размещения маркера.
- **Подсостояния/События**:
  - Временный маркер размещен на карте.
  - Всплывающее окно редактора заметок видимо.
  - Пользователь вводит текст заметки.
  - Пользователь выбирает дату для заметки.
  - Пользователь выбирает значок для заметки.
- **Переходы**:
  - В состояние просмотра карты (когда заметка сохранена).
  - В состояние просмотра карты (когда создание заметки отменено).
  - В состояние выбора значка (при выборе значка).

### 6. **Состояние редактирования заметки**
- **Описание**: Пользователь редактирует существующую заметку.
- **Действия**: Отображение всплывающего окна редактора заметок с существующими данными заметки.
- **Триггеры**: Пользователь долго нажимает на маркер существующей заметки.
- **Подсостояния/События**:
  - Всплывающее окно редактора заметок показывает существующее содержимое.
  - Пользователь изменяет текст заметки.
  - Пользователь изменяет назначенную дату.
  - Пользователь меняет значок.
  - Пользователь управляет связанными заметками.
  - Пользователь удаляет заметку.
- **Переходы**:
  - В состояние просмотра карты (когда заметка сохранена).
  - В состояние просмотра карты (когда редактирование отменено).
  - В состояние подтверждения удаления (когда заметка удаляется).
  - В состояние создания связи (при связывании с другой заметкой).
  - В состояние выбора значка (при выборе значка).

### 7. **Состояние просмотра заметки**
- **Описание**: Пользователь просматривает заметку без редактирования.
- **Действия**: Отображение информационного окна с содержимым заметки.
- **Триггеры**: Пользователь нажимает на маркер существующей заметки.
- **Подсостояния/События**:
  - Появляется информационное окно с текстом заметки.
  - Отображаются детали заметки.
- **Переходы**:
  - В состояние просмотра карты (при нажатии в другом месте).
  - В состояние редактирования заметки (при переходе в режим редактирования).
  - В состояние создания связи (при связывании с другой заметкой).

### 8. **Состояние создания связи**
- **Описание**: Пользователь находится в процессе связывания заметок.
- **Действия**: Интерфейс для соединения заметок, визуальная обратная связь для связывания.
- **Триггеры**: Пользователь выбирает опцию «связать» в заметке.
- **Подсостояния/События**:
  - Активирован режим связывания.
  - Пользователь выбирает первую заметку для связи.
  - Пользователь выбирает вторую заметку для связи.
  - Создана связь между заметками.
- **Переходы**:
  - В состояние просмотра карты (когда связывание завершено).
  - В состояние редактирования заметки (при возврате к редактированию заметки).
  - В состояние просмотра карты (когда связывание отменено).

### 9. **Состояние выбора значка**
- **Описание**: Пользователь выбирает значок для заметки.
- **Действия**: Отображение галереи значков, возможность выбора значка.
- **Триггеры**: Пользователь нажимает кнопку «выбрать значок» в редакторе заметок.
- **Подсостояния/События**:
  - Отображается диалоговое окно выбора значка.
  - Пользователь просматривает доступные значки.
  - Пользователь выбирает значок.
- **Переходы**:
  - В состояние создания заметки (когда значок выбран).
  - В состояние редактирования заметки (когда значок выбран).
  - В состояние создания заметки (когда выбор значка отменен).
  - В состояние редактирования заметки (когда выбор значка отменен).

### 10. **Состояние фильтрации по календарю**
- **Описание**: Пользователь применяет фильтры по дате к заметкам.
- **Действия**: Отображение интерфейса календаря, выбор диапазона дат.
- **Триггеры**: Пользователь нажимает кнопку календаря.
- **Подсостояния/События**:
  - Отображается вид календаря.
  - Пользователь выбирает диапазон дат.
  - Заметки отфильтрованы по выбранным датам.
- **Переходы**:
  - В состояние просмотра карты (когда фильтр применен).
  - В состояние просмотра карты (когда календарь закрыт).

### 11. **Состояние поиска**
- **Описание**: Пользователь ищет определенные заметки.
- **Действия**: Активно поле ввода для поиска, фильтрация результатов, выделение совпадений.
- **Триггеры**: Пользователь вводит текст в строку поиска.
- **Подсостояния/События**:
  - Ввод текста в поле поиска.
  - Результаты поиска обновляются в реальном времени.
  - Соответствующие заметки подсвечиваются на карте.
  - Несоответствующие заметки скрыты.
- **Переходы**:
  - В состояние просмотра карты (когда поиск очищен).
  - В состояние просмотра заметки (при выборе результата поиска).
  - В состояние редактирования заметки (при выборе результата поиска для редактирования).

### 12. **Состояние подтверждения удаления**
- **Описание**: Пользователь подтверждает удаление заметки.
- **Действия**: Отображение диалогового окна подтверждения.
- **Триггеры**: Пользователь нажимает кнопку удаления в редакторе заметок.
- **Подсостояния/События**:
  - Появляется диалоговое окно подтверждения.
  - Пользователь подтверждает или отменяет удаление.
- **Переходы**:
  - В состояние просмотра карты (когда удаление подтверждено).
  - В состояние редактирования заметки (когда удаление отменено).

### 13. **Состояние навигации по карте**
- **Описание**: Пользователь перемещается по карте (масштабирование, панорамирование).
- **Действия**: Взаимодействие с картой, отслеживание местоположения.
- **Триггеры**: Пользователь выполняет жесты на карте или нажимает кнопки навигации.
- **Подсостояния/События**:
  - Увеличение/уменьшение масштаба.
  - Панорамирование карты.
  - Центрирование по местоположению пользователя.
- **Переходы**:
  - В состояние просмотра карты (когда навигация завершена).

### 14. **Состояние выхода**
- **Описание**: Приложение закрывается.
- **Действия**: Сохранение текущего состояния, очистка ресурсов.
- **Триггеры**: Пользователь выходит из приложения.
- **Переходы**: Нет (приложение завершает работу).

## Сводка переходов между состояниями

- Большинство состояний возвращаются в **Состояние просмотра карты** (основной вид приложения).
- **Состояние просмотра карты** является центральным узлом, связывающим другие состояния.
- **Состояние создания заметки** и **Состояние редактирования заметки** имеют схожие элементы пользовательского интерфейса и переходы.
- **Состояние поиска** и **Состояние фильтрации по календарю** могут работать независимо или вместе.
- Состояния, связанные с разрешениями, должны быть разрешены до перехода к основным состояниям приложения.

## Ключевые компоненты пользовательского интерфейса в состояниях

- MapView: Присутствует в состояниях просмотра карты, создания заметки, редактирования заметки и просмотра заметки.
- Всплывающее окно редактора заметок: Присутствует в состояниях создания и редактирования заметки.
- Строка поиска: Доступна в состоянии просмотра карты и остается активной во время поиска.
- Элементы управления навигацией: Доступны в состоянии просмотра карты для масштабирования и определения местоположения.
- Выбор значка: Модальное диалоговое окно в состоянии выбора значка.

## Особые соображения

- Система состояний должна поддерживать согласованность данных при переходах между состояниями.
- Изменения данных заметки должны сохраняться во всех состояниях.
- Состояния поиска и фильтрации должны быть аддитивными (поиск в отфильтрованных результатах).
- Создание связи должно проверять, что заметки существуют и могут быть связаны.
- Разрешения GPS критически важны для основной функциональности.
- Функциональность в автономном режиме может быть ограничена в зависимости от реализации карты.