# Архитектурный документ

## 1. Введение
В этом документе описывается архитектура программного обеспечения для Android-приложения **YouClue**. Приложение спроектировано как одноэкранная утилита, ориентированная на карту. Архитектура намеренно упрощена, вся основная логика и взаимодействие с пользователем сосредоточены в одном Android `Activity`. Этот подход хорошо подходит для конкретной области применения приложения, которая сосредоточена на одной основной функции: взаимодействии с заметками на карте.

## 2. Архитектурный стиль
Приложение следует архитектурному стилю, **ориентированному на представление** или **основанному на Activity**. Это можно рассматривать как прагматичную реализацию шаблона **Model-View-Controller (MVC)**, где `Activity` (`MainActivity`) берет на себя роли как **Представления**, так и **Контроллера**.

-   **Модель:** Структуры данных приложения, в основном классы данных `Note` и `Coordinates`. Они являются простыми контейнерами данных без бизнес-логики.
-   **Представление:** Пользовательский интерфейс, определенный в XML-файлах макета (`activity.xml`, `note_editor_popup.xml` и т. д.) и отображаемый ОС Android. `MapView` от MapLibre является ключевым компонентом Представления.
-   **Контроллер:** Класс `MainActivity` действует как центральный контроллер. Он прослушивает ввод пользователя из Представления (клики по карте, нажатия кнопок), обрабатывает его, управляет Моделью (списком заметок в памяти) и обновляет Представление для отражения изменений (например, рисуя новый маркер на карте).

Этот стиль был выбран из-за его простоты и прямоты, что позволяет избежать накладных расходов более сложных шаблонов, таких как MVVM или MVI, которые не являются необходимыми для приложения такого масштаба и области применения.

## 3. Компоненты
Приложение состоит из нескольких ключевых компонентов:

-   **`MainActivity.kt`**: Это основной компонент приложения. Он отвечает за:
    -   Инициализацию и настройку `MapView` от MapLibre.
    -   Загрузку и сохранение заметок из локального хранилища.
    -   Обработку всех взаимодействий с пользователем, включая жесты на карте и нажатия кнопок.
    -   Управление состоянием приложения (например, какая заметка редактируется, виден ли всплывающий редактор).
    -   Отображение всех визуальных элементов на карте, таких как маркеры заметок и соединяющие их линии.
    -   Обработку разрешений на определение местоположения и получение текущего местоположения пользователя.

-   **Модели данных (`Note.kt`)**: Набор файлов `data class` на Kotlin, которые определяют структуру данных приложения. Основной моделью является `Note`, которая представляет одну заметку с геотегами.

-   **Хранилище (`LocalStorageHandler.kt`)**: Этот компонент абстрагирует логику сохранения данных. Он отвечает за сериализацию списка объектов `Note` в строку JSON (с использованием Gson) и запись ее в локальный файл, а также за соответствующий процесс десериализации при чтении файла.

-   **Адаптеры пользовательского интерфейса (`IconAdapter.kt`, `LinkedNoteAdapter.kt`)**: Стандартные адаптеры Android, используемые для заполнения виджетов `GridView` и `RecyclerView` в пользовательском интерфейсе. Например, `IconAdapter` отображает сетку выбираемых значков, а `LinkedNoteAdapter` отображает список связанных заметок во всплывающем редакторе.

-   **Макеты (XML-файлы)**: Эти файлы определяют структуру и внешний вид пользовательского интерфейса. Основной макет — `activity.xml`, который содержит `MapView` и основные элементы управления пользовательского интерфейса. Другие макеты, такие как `note_editor_popup.xml`, определяют модульные компоненты пользовательского интерфейса.

-   **Утилиты (`ColorUtils.kt`)**: Вспомогательные классы, содержащие логику без состояния, пригодную для повторного использования. `ColorUtils` предоставляет функцию для определения цвета маркера заметки на основе ее даты.

## 4. Управление данными
-   **Модель данных**: Данные приложения смоделированы вокруг основного объекта `Note`, который содержит координаты, текст, даты, необязательный значок и список идентификаторов других заметок, с которыми он связан.
-   **Хранение данных**: Все данные приложения хранятся в одном файле JSON с именем `notes.json` во внутреннем частном хранилище приложения. База данных отсутствует.
-   **Поток данных**: Поток данных прост:
    1.  При запуске приложения `MainActivity` считывает файл `notes.json` и десериализует его содержимое в `MutableList<Note>` в памяти.
    2.  Все операции (создание, редактирование, удаление, связывание) выполняются непосредственно с этим списком в памяти.
    3.  После каждого изменения весь список повторно сериализуется в JSON и записывается обратно в файл `notes.json`, перезаписывая предыдущее содержимое. Это обеспечивает сохранение данных.

## 5. Пользовательский интерфейс
Пользовательский интерфейс создан с использованием **системы представлений Android** с макетами, определенными в **XML**. Он не создан с помощью Jetpack Compose.

-   **`MainActivity`** напрямую управляет всеми виджетами пользовательского интерфейса. Он содержит ссылки на кнопки, текстовые поля и сам вид карты.
-   Взаимодействия с пользователем обрабатываются через прослушиватели событий (например, `setOnClickListener`, `addOnMapClickListener`), настроенные в `MainActivity`.
-   Обновления пользовательского интерфейса выполняются императивно. Код в `MainActivity` напрямую вызывает методы объектов Представления для изменения их состояния, видимости или содержимого (например, `popUp.setVisibility(View.VISIBLE)`, `maplibreMap.addLayer(...)`).

## 6. Внешние сервисы
Приложение использует два основных внешних сервиса:

-   **MapTiler**: Предоставляет фрагменты карты и стили карты. Приложение взаимодействует с API MapTiler, используя ключ API для получения данных визуальной карты.
-   **Сервисы Google Play (местоположение)**: Используется для доступа к службам определения местоположения устройства. Это позволяет приложению получать текущее географическое положение пользователя для функции «найти мое местоположение».
